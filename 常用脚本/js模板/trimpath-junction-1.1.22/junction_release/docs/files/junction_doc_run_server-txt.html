<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><title>Runtime On The Server</title><link rel="stylesheet" type="text/css" href="../styles/main.css"><script language=JavaScript src="../javascript/main.js"></script></head><body class=UnframedPage onLoad="NDOnLoad()"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.35 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->

<table border=0 cellspacing=0 cellpadding=0 width=100%><tr><td class=MenuSection valign=top><!--START_ND_MENU--><div class=MEntry><div class=MFile><a href="junction_doc_about-txt.html">About TrimPath Junction</a></div></div><div class=MEntry><div class=MFile><a href="junction_doc_run-txt.html">Runtime Environments</a></div></div><div class=MEntry><div class=MFile><a href="junction_doc_run_browser-txt.html">Runtime In The Browser</a></div></div><div class=MEntry><div class=MFile id=MSelected>Runtime On The Server</div></div><div class=MEntry><div class=MFile><a href="junction_doc_sync-txt.html">Synchronization</a></div></div><div class=MEntry><div class=MFile><a href="junction_doc_translation-txt.html">Translations</a></div></div><div class=MEntry><div class=MFile><a href="junction-js.html">TrimPath.<span class=HB> </span>junction</a></div></div><div class=MEntry><div class=MFile><a href="junctionClient-js.html">TrimPath.<span class=HB> </span>junctionClient</a></div></div><div class=MEntry><div class=MFile><a href="junctionHelpers-js.html">TrimPath.<span class=HB> </span>junctionHelpers</a></div></div><div class=MEntry><div class=MFile><a href="junctionUtil-js.html">TrimPath.<span class=HB> </span>junctionUtil</a></div></div><div class=MEntry><div class=MFile><a href="junction_doc_controller-txt.html">web-MVC Controller</a></div></div><div class=MEntry><div class=MFile><a href="junction_doc_model-txt.html">web-MVC Model</a></div></div><div class=MEntry><div class=MFile><a href="junction_doc_view-txt.html">web-MVC View</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">Index</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MIndex><a href="../index/General.html">Everything</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Classes.html">Classes</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Functions.html">Functions</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Variables.html">Variables</a></div></div><div class=MEntry><div class=MIndex><a href="../index/Properties.html">Properties</a></div></div></div></div></div><!--END_ND_MENU--></td>

<td class=ContentSection valign=top><div class=CGeneric id=MainTopic><div class=CTopic><h1 class=CTitle><a name="Runtime_On_The_Server"></a>Runtime On The Server</h1><div class=CBody><p class=CParagraph>The Junction server-side web application server (SSWAS) is implemented on top of the open-source Helma Object Publisher (HOP) server.&nbsp;  More information about HOP is available at <a href="http://helma.org" class=LURL>http://helma.org</a>.</p><p class=CParagraph>The HOP server is a production-ready, JavaScript web application server implemented using the open-source Rhino JavaScript interpreter and Java.&nbsp; The HOP server comes with an embedded Jetty web server, and many other features.</p><h4 class=CHeading>Running</h4><p class=CParagraph>To install and start the Junction SSWAS, see the directions under [junction_release]/RUNNING.txt</p><h4 class=CHeading>Team Space Directories</h4><p class=CParagraph>The Junction SSWAS is designed for multi-team hostability, where you can host the applications of several small business customers or enterprise workgroups on a single Junction SSWAS instance.</p><p class=CParagraph>Each small business customer or enterprise workgroup is assigned their own <b>team space</b>.</p><p class=CParagraph>Each team space is assigned its own subdirectory.&nbsp;  These team space directories are stored under the [junction_release].spaces directory.&nbsp; For example...</p><blockquote><pre class=CCode>[junction_release].spaces/<br>  0/<br>  1/<br>  2/</pre></blockquote><p class=CParagraph>In the above example, we can tell that there are three team spaces, which by convention, have a numeric directory name.</p><p class=CParagraph>You may, of course, just run Junction with a single team space, in which case there&rsquo;s only one subdirectory under the [junction_release].spaces directory.</p><h4 class=CHeading>Application Directories</h4><p class=CParagraph>Each team space may have one or more Junction applications.&nbsp; Each Junction application has its own subdirectory...</p><blockquote><pre class=CCode>[junction_release].spaces/<br>  0/<br>    nextaction/<br>    wikiaction/<br>    salesaction/<br>  1/<br>    nextaction/<br>    contactApp/</pre></blockquote><p class=CParagraph>In the above example, we can see that team space 0 has three applications in it, while team space 1 has just two applications in it.&nbsp;  Team 0 and team 1 are both running the nextaction application, albeit possibly different versions of Next Action.</p><p class=CParagraph>Application directory names must be alphanumeric only.&nbsp;  No punctuation.</p><p class=CParagraph>Application developers might consider prefixing their application directory names, if they wish to publicly distribute their Junction applications, to avoid namespace collisions.&nbsp; For example, trimpath_nextaction and trimpath_salesaction.</p><h4 class=CHeading>Application URL&rsquo;s</h4><p class=CParagraph>The team space and application directory names are visible in the URL&rsquo;s sent to the Junction application server.&nbsp;  For example...</p><ul class=CBulletList><li><a href="http://localhost:8080/engines/0/apps/nextaction" class=LURL>http://localhost:8080/engines/0/apps/nextaction</a></li><li><a href="http://localhost:8080/engines/0/apps/salesaction" class=LURL>http://localhost:8080/engines/0/apps/salesaction</a></li><li><a href="http://localhost:8080/engines/1/apps/contactApp" class=LURL>http://localhost:8080/engines/1/apps/contactApp</a></li></ul><h4 class=CHeading>Application Directory Structure</h4><p class=CParagraph>Each application directory structure looks like...</p><blockquote><pre class=CCode>[junction_release].spaces/<br>  122/<br>    nextaction/<br>      code/<br>        app/<br>          controllers/<br>          models/<br>          views/<br>        db/<br>          migrate/<br>        public/<br>          javascripts/<br>          stylesheets/<br>      db.sqlite3</pre></blockquote><h4 class=CHeading>Code Directory</h4><p class=CParagraph>The code directory contains all the application static code resources.&nbsp; By static, we assume that application code and files are not normally changed during application runtime, for easier cache-ability by the Junction system.</p><p class=CParagraph>Also, files in the code directory are bundled together and sent to the web-browser during client-side Junction execution.</p><p class=CParagraph>During production deployment, the code directories are sometimes checked into a source-code-control-system (SCCS), such as Subversion or CVS.&nbsp;  A production pool of Junction SSWAS instances on a server farm, then, could be implemented to do a SCCS update/pull.</p><p class=CParagraph>In general, the Junction system does not put runtime or dynamically generated files, such as log, cache, or tmp files, into the code directory.&nbsp;  This enables easier delta comparisons with SCCS systems.&nbsp;  Instead, dynamically generated or modified files or directories, such as cache files, are created as siblings to the code directory.</p><p class=CParagraph>The last-modified filesystem timestamp of the code directory is important.&nbsp;  The code directory last-modified timestamp is used by the Junction SSWAS as the application&rsquo;s code version number.&nbsp; Thus, if you&rsquo;ve changed any file that lives within the code directory tree, and you want current clients to receive that new code, you should update or &lsquo;touch&rsquo; the code directory&rsquo;s last-modified timestamp.&nbsp; The current clients will receive the new code on their next synchronization request.</p><h4 class=CHeading>Independent Database Per Team-space and Application</h4><p class=CParagraph>Each application within a team-space has its own a separate RDBMS database.&nbsp;  So, RDBMS records from different applications or from different team spaces will not be mixed together.</p><p class=CParagraph>When using the Sqlite3 driver (the default driver), the Junction SSWAS automatically creates a db.sqlite3 file as the RDBMS storage.&nbsp; The db.sqlite3 file is created on-demand, or only as needed, by the Junction SSWAS under the team-space/application directory, as a sibling to the code directory for the application.</p><p class=CParagraph>The sqlite3 program (available from <a href="http://sqlite.org" class=LURL>http://sqlite.org</a>) can be used to directly access and query the db.sqlite3 file, such as for batch SQL operations or dump/backups.</p><h4 class=CHeading>Code Sharing or Linking</h4><p class=CParagraph>You may wish for multiple teams to share the same application code, but each have their own independent database.&nbsp;  This is accomplished by creating a code.link file instead of a code directory.&nbsp; The code.link file contents should be a single line, of [spaceDir]/[appDir].&nbsp;  For example...</p><blockquote><pre class=CCode>[junction_release].spaces/<br>  100/<br>    nextaction/<br>      code/<br>        app/<br>          controllers/<br>          models/<br>          views/<br>        db/<br>          migrate/<br>        public/<br>          javascripts/<br>          stylesheets/<br>      db.sqlite3<br>  200/<br>    nextaction/<br>      code.link<br>      db.sqlite3<br>  201/<br>    nextaction/<br>      code.link<br>      db.sqlite3<br>  202/<br>    nextaction/<br>      code.link<br>      db.sqlite3</pre></blockquote><p class=CParagraph>Above, only the 100/nextaction directory has a true application code directory.&nbsp; All other spaces (200, 201, 202) have a code.link file whose contents are...</p><blockquote><pre class=CCode>100/nextaction</pre></blockquote><p class=CParagraph>That points the Junction system to use the code from 100/nextaction/code.</p><p class=CParagraph>Any code updates to 100/nextaction/code will be automatically shared or inherited by 200/nextaction, 201/nextaction, 202/nextaction.&nbsp; Those linked spaces have their own independent db.sqlite3 databases.</p><h4 class=CHeading>Applicaton System Actions</h4><p class=CParagraph>A URL to an application can specify a system action or verb to execute against the application.&nbsp;  The action/verb is expressed as a semicolon (;) suffix: <a href="http://localhost:8080/engines/0/apps/nextaction;" class=LURL>http://localhost:8080/engines/0/apps/nextaction;</a>[action]</p><h4 class=CHeading>Valid systems actions</h4><ul class=CBulletList><li>invoke - this is the default system action.&nbsp; This action executes a controller/action-method on the server-side.&nbsp; For example: <a href="http://localhost:8080/engines/0/apps/nextaction;invoke?controllerName=home&actionName=index" class=LURL>http://localhost:8080<span class=HB>- </span>/engines<span class=HB>- </span>/0<span class=HB>- </span>/apps<span class=HB>- </span>/nextaction;invoke?controllerName=home<span class=HB>- </span>&amp;actionName=index</a> is equivalent to <a href="http://localhost:8080/engines/0/apps/nextaction?controllerName=home&actionName=index" class=LURL>http://localhost:8080<span class=HB>- </span>/engines<span class=HB>- </span>/0<span class=HB>- </span>/apps<span class=HB>- </span>/nextaction?controllerName=home<span class=HB>- </span>&amp;actionName=index</a></li><li>start - execute the application on the client-side web-browser.&nbsp; The response HTML page contains the complete application code and resources, with the client-side Junction system.</li><li>migrate - for development or administrative use.&nbsp;  Executes a migration on the server-side RDBMS.&nbsp;  A version parameter lets you specify which database version to migrate to, which defaults to the highest or latest version.&nbsp;  For example: <a href="http://localhost:8080/engines/0/apps/nextaction;migrate?version=0" class=LURL>http://localhost:8080<span class=HB>- </span>/engines<span class=HB>- </span>/0<span class=HB>- </span>/apps<span class=HB>- </span>/nextaction;migrate?version=0</a> effectively drops all tables of the application in the server-side RDBMS.&nbsp; <a href="http://localhost:8080/engines/0/apps/nextaction;migrate?version=1" class=LURL>http://localhost:8080<span class=HB>- </span>/engines<span class=HB>- </span>/0<span class=HB>- </span>/apps<span class=HB>- </span>/nextaction;migrate?version=1</a> migrates the server-side RDBMS through its first migration step.&nbsp; <a href="http://localhost:8080/engines/0/apps/nextaction;migrate" class=LURL>http://localhost:8080<span class=HB>- </span>/engines<span class=HB>- </span>/0<span class=HB>- </span>/apps<span class=HB>- </span>/nextaction;migrate</a> migrates the server-side RDBMS through all migration steps, bringing the database version up to the latest available version.</li><li>public - accesses a resource in the application&rsquo;s code/public subdirectory.&nbsp; For example: <a href="http://localhost:8080/engines/0/apps/nextaction;public?path=stylesheets/app.css" class=LURL>http://localhost:8080<span class=HB>- </span>/engines<span class=HB>- </span>/0<span class=HB>- </span>/apps<span class=HB>- </span>/nextaction;public?path=stylesheets<span class=HB>- </span>/app.css</a></li><li>manifest - returns a Google Gears manifest JSON file for the application.&nbsp; For example: <a href="http://localhost:8080/engines/0/apps/nextaction;manifest" class=LURL>http://localhost:8080<span class=HB>- </span>/engines<span class=HB>- </span>/0<span class=HB>- </span>/apps<span class=HB>- </span>/nextaction;manifest</a></li></ul><h4 class=CHeading>System Log Files</h4><p class=CParagraph>Junction system log files are provided by the HOP logging infrastructure.&nbsp; HOP defaults to putting log files in the [junction_release]/hop/log directory, with automatic log rotation and log-archive-compression (gzip).</p><p class=CParagraph>Junction server-specific log files follow a naming pattern of [junction_release]/hop/log/helma.engines.*</p><p class=CParagraph>A useful Unix command to see log files (such as during application development)...</p><blockquote><pre class=CCode>tail -f [junction_release]/hop/log/helma.engines.event.log</pre></blockquote><h4 class=CHeading>Debugging</h4><p class=CParagraph>During application development, you can configure extra debug information by adding the following to the [junction_release]/hop.apps/engines/app.properties file...</p><blockquote><pre class=CCode>debug = true</pre></blockquote><p class=CParagraph>Also, on a development workstation, a GUI JavaScript debugger is available, which is a feature of the HOP system.&nbsp;  To use the GUI debugger, see the documentation available in your local workstation installation by visiting <a href="http://localhost:8080/tools/debugger" class=LURL>http://localhost:8080/tools/debugger</a></p><h4 class=CHeading>Administrative Marker Files</h4><p class=CParagraph>A system administrator can create specially-named marker files, to signal to the Junction system, for example, to disable a space or application.&nbsp;  You can place these files in either a team space directory (to mark an entire space), or in an application directory (to mark just one application).&nbsp; In the application directory, the marker file should be a sibling to the application&rsquo;s code directory).</p><blockquote><pre class=CCode>__DISABLED__   - Marks a team space or a single application as disabled,<br>                 meaning any requests into the space or application<br>                 are rejected by the Junction SSWAS.  This is useful<br>                 for upgrade downtimes.<br><br>__READONLY__   - Marks a team space or a single application<br>                 as read-only, meaning any database modification requests<br>                 in the team space or an application will be rejected.<br>                 Modifications rejected include INSERT/UPDATE/DELETE and<br>                 schema changes (DDL).  This is potentially useful<br>                 for backups or other upgrade downtime needs.<br><br>__NOINVOKE__   - Marks a team space or a single application<br>                 in a team space as not executable on the server-side.<br><br>__NOSTART__    - Marks a team space or a single application<br>                 in a team space as not executable on the client-side.<br><br>__NOSYNC__     - Prevents access to sync protocol service<br>                 in a team space or application.<br><br>__NOMIGRATE__  - Prevents access to the migrate action of a<br>                 team space or application.<br><br>__NOMANIFEST__ - Prevents access to the Google Gears manifest<br>                 information in a team space or application.</pre></blockquote><h4 class=CHeading>Other HOP Applications</h4><p class=CParagraph>The Junction release comes with the default HOP system, which includes several pre-installed applications, such as <a href="http://localhost:8080/manage" class=LURL>http://localhost:8080/manage</a> and <a href="http://localhost:8080/welcome" class=LURL>http://localhost:8080/welcome</a>.&nbsp;  Please visit those pages to learn more about them, and to consider disabling them before a public production launch.</p><h4 class=CHeading>Users</h4><p class=CParagraph>The basic Junction server system allows each team space to have an independent set of users.&nbsp;  These users are defined under the <u> users </u> directory under each team space directory.&nbsp;  For example...</p><blockquote><pre class=CCode>[junction_release].spaces/<br>  0/<br>    __users__/<br>      alex.json<br>      brenda.json<br>      tom.json<br>  1/<br>    __users__/<br>      __anonymous__.json<br>      hillary.json<br>      mitt.json<br>      rudy.json</pre></blockquote><p class=CParagraph>In the above example, team space 0 has 3 users: alex, brenda, and tom.&nbsp; Team space 1 has 4 users: hillary, mitt, rudy, and a special &lsquo;<u> anonymous </u>&rsquo; user.</p><p class=CParagraph>The user JSON files can contain extra information about each user, but as a first step, Junction checks for just the existence of the user JSON file as a signal that a user is allowed to access a team space.</p><p class=CParagraph>The file base name of a user JSON file (e.g., &lsquo;alex&rsquo;, from alex.json), is known as the <b>user key</b>.&nbsp;  For team space 0, the user keys are alex, brend, and tom.</p><p class=CParagraph>As described in the next section, the last-modified timestamps of the user files are important for the Junction system to determine authentication and authorization.</p><p class=CParagraph>The special <u> anonymous </u> user file is checked for existence by the Junction server system to determine whether anonymous users (not logged in users) are allowed to access a team space.</p><h4 class=CHeading>The junctionToken_[spaceKey] cookie</h4><p class=CParagraph>For each request, the Junction server system checks for the existence and correctness of a junctionToken_[spaceKey] cookie to determine the current logged-in user.&nbsp;  When the junctionToken_[spaceKey] cookie is missing, the Junction server assumes the current user is anonymous (that is, the userKey is null).&nbsp; For example, the cookie name might be junctionToken_0 or junctionToken_100.</p><p class=CParagraph>The current user is then checked against the team space <u> users </u> directory to see whether the current user belongs to the allowed users for the team space of the request.</p><p class=CParagraph>The junctionToken_[spaceKey] cookie should have a value of &lsquo;userKey|userStamp&rsquo;, where the userStamp is the encrypted last-modified timestamp (in seconds since the Unix epoch) of the user JSON file.&nbsp;  For example: alex|1239842379349</p><p class=CParagraph>Integration with other systems is thus very simple.&nbsp;  For example, you might have a separate PHP (or Rails or ASP) application running on the same server/domain (mounted into the same URL space) that provides a true user login service.&nbsp;  When users login into the PHP system, the PHP code can also set a junctionToken_[spaceKey] cookie, and redirect to a Junction server URL.&nbsp;  The PHP code needs access to the [junction_release].spaces directory tree, especially as the file last-modified timestamp is the server-side secret information it shares with the Junction system.&nbsp;  The PHP code can also easily create the right &lsquo;<u> users </u>&rsquo; directories and files per team space.&nbsp;  Please see the userCheck.js file for information on the userStamp encryption algorithm.</p><p class=CParagraph>When the user logs out of the PHP system, the PHP code should reset or clear the junctionToken_[spaceKey] cookie and also &lsquo;touch&rsquo; the last-modified timestamp of the user JSON file.</p><p class=CParagraph>This design allows for high independence between login managment systems (e.g., the PHP system) and the Junction servers.&nbsp; For example, restarting one system, such as the PHP system, does not affect the Junction runtime servers.&nbsp;  Please see the hop.apps/engines_sessions application for an example of a &lsquo;separate&rsquo; system that controls the login/logout sessions for Junction.</p></div></div></div>

</td>

</tr></table><div class=Footer><!--START_ND_FOOTER-->Generated by <a href="http://www.naturaldocs.org">Natural Docs</a><!--END_ND_FOOTER--></div>
<!--START_ND_TOOLTIPS-->
<!--END_ND_TOOLTIPS-->

<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>