(function(){
    QZONE.shop.suit = {};
    QZONE.shop.suit.data = {
        //small
        0: {
            'img': 'http://imgcache.qq.com/qzone/mall/static/customsuit/small.jpg',
            'more': '/mall?target=bighouse',
            'item': {
                Fitem_id: '38932',
                Fitem_name: '甜蜜',
                Fprice: '600',
                Fvip_price: '600',
                Fdiscount: '100',
                Ftype_id: '1',
                Fupload_time: '2009-01-10 16:57:01',
                Fdesc: '0@gif|80_0_jpg|jpg',
                Fitem_type: '',
                Fother_price: '0',
                Fitem_exptime: '186',
                Fitem_mode: '2',
                Fitem_remark: '38928|38929|38930|38931',
                Fitem_tag: '粉色 可爱 快乐 女生 动物'
            }
        },
        //all
        1: {
            'img': 'http://imgcache.qq.com/qzone/space_item/pre/10/45642_2.gif',
            'more': '/mall?target=bighouse',
            'item': {
                Fitem_id: '45642',
                Fitem_name: '好幸福',
                Fprice: '1700',
                Fvip_price: '1700',
                Fdiscount: '100',
                Ftype_id: '31',
                Fupload_time: '2009-08-27 17:32:17',
                Fdesc: '45637|45638|45639|45641',
                Fitem_type: '',
                Fother_price: '0',
                Fitem_exptime: '186',
                Fitem_mode: '0',
                Fitem_remark: '45637|45638|45639|45641',
                Fitem_tag: '冷色 可爱 快乐 男生',
                suitItems: [{
                    Fitem_id: '45637',
                    Fitem_name: '好幸福',
                    Fprice: '420',
                    Fvip_price: '420',
                    Fdiscount: '100',
                    Ftype_id: '19',
                    Fupload_time: '2009-08-27 17:28:41',
                    Fdesc: 'png',
                    Fitem_type: '',
                    Fother_price: '0',
                    Fitem_exptime: '186',
                    Fitem_mode: '0',
                    Fitem_remark: '45638|45639|45641',
                    Fitem_tag: '冷色 简洁 快乐 男生'
                }, {
                    Fitem_id: '45638',
                    Fitem_name: '好幸福',
                    Fprice: '520',
                    Fvip_price: '520',
                    Fdiscount: '100',
                    Ftype_id: '6',
                    Fupload_time: '2009-08-27 17:29:20',
                    Fdesc: 'swf',
                    Fitem_type: '',
                    Fother_price: '0',
                    Fitem_exptime: '186',
                    Fitem_mode: '0',
                    Fitem_remark: '45637|45639|45641',
                    Fitem_tag: '白色 浪漫 甜蜜 女生'
                }, {
                    Fitem_id: '45639',
                    Fitem_name: '好幸福',
                    Fprice: '520',
                    Fvip_price: '520',
                    Fdiscount: '100',
                    Ftype_id: '13',
                    Fupload_time: '2009-08-27 17:29:55',
                    Fdesc: '0',
                    Fitem_type: '',
                    Fother_price: '0',
                    Fitem_exptime: '186',
                    Fitem_mode: '0',
                    Fitem_remark: '45637|45638|45641',
                    Fitem_tag: '白色 浪漫 甜蜜 女生'
                }, {
                    Fitem_id: '45641',
                    Fitem_name: '好幸福',
                    Fprice: '600',
                    Fvip_price: '600',
                    Fdiscount: '100',
                    Ftype_id: '1',
                    Fupload_time: '2009-08-27 17:31:14',
                    Fdesc: '0@gif|80_0_jpg|jpg',
                    Fitem_type: '',
                    Fother_price: '0',
                    Fitem_exptime: '186',
                    Fitem_mode: '2',
                    Fitem_remark: '45637|45638|45639',
                    Fitem_tag: '冷色 可爱 快乐 男生'
                }]
            }
        },
        //wide
        3: {
            'img': 'http://imgcache.qq.com/qzone/space_item/pre/12/45612_2.gif',
            'more': '/mall?target=bighouseskin',
            'item': {
                Fitem_id: '45612',
                Fitem_name: '我俩',
                Fprice: '2100',
                Fvip_price: '2100',
                Fdiscount: '100',
                Ftype_id: '31',
                Fupload_time: '2009-08-27 16:30:04',
                Fdesc: '45607|45608|45609|45610|45611',
                Fitem_type: '',
                Fother_price: '0',
                Fitem_exptime: '186',
                Fitem_mode: '0',
                Fitem_remark: '45607|45608|45609|45610|45611',
                Fitem_tag: '冷色 LOMO 快乐 女生',
                suitItems: [{
                    Fitem_id: '45607',
                    Fitem_name: '我俩',
                    Fprice: '420',
                    Fvip_price: '420',
                    Fdiscount: '100',
                    Ftype_id: '19',
                    Fupload_time: '2009-08-27 16:26:30',
                    Fdesc: 'png',
                    Fitem_type: '',
                    Fother_price: '0',
                    Fitem_exptime: '186',
                    Fitem_mode: '0',
                    Fitem_remark: '45608|45609|45610|45611',
                    Fitem_tag: '粉色 浪漫 快乐 女生'
                }, {
                    Fitem_id: '45608',
                    Fitem_name: '我俩',
                    Fprice: '520',
                    Fvip_price: '520',
                    Fdiscount: '100',
                    Ftype_id: '6',
                    Fupload_time: '2009-08-27 16:27:08',
                    Fdesc: 'swf',
                    Fitem_type: '',
                    Fother_price: '0',
                    Fitem_exptime: '186',
                    Fitem_mode: '0',
                    Fitem_remark: '45607|45609|45610|45611',
                    Fitem_tag: '粉色 浪漫 幸福 女生'
                }, {
                    Fitem_id: '45609',
                    Fitem_name: '我俩',
                    Fprice: '520',
                    Fvip_price: '520',
                    Fdiscount: '100',
                    Ftype_id: '13',
                    Fupload_time: '2009-08-27 16:27:36',
                    Fdesc: '1',
                    Fitem_type: '',
                    Fother_price: '0',
                    Fitem_exptime: '186',
                    Fitem_mode: '0',
                    Fitem_remark: '45607|45608|45610|45611',
                    Fitem_tag: '粉色 浪漫 幸福 女生'
                }, {
                    Fitem_id: '45610',
                    Fitem_name: '我俩',
                    Fprice: '350',
                    Fvip_price: '350',
                    Fdiscount: '100',
                    Ftype_id: '2',
                    Fupload_time: '2009-08-27 16:28:08',
                    Fdesc: 'gif',
                    Fitem_type: '',
                    Fother_price: '0',
                    Fitem_exptime: '186',
                    Fitem_mode: '0',
                    Fitem_remark: '45607|45608|45609|45611',
                    Fitem_tag: '冷色 浪漫 幸福 男生'
                }, {
                    Fitem_id: '45611',
                    Fitem_name: '我俩',
                    Fprice: '600',
                    Fvip_price: '600',
                    Fdiscount: '100',
                    Ftype_id: '1',
                    Fupload_time: '2009-08-27 16:28:39',
                    Fdesc: '@gif|80_0_jpg|jpg',
                    Fitem_type: '',
                    Fother_price: '0',
                    Fitem_exptime: '186',
                    Fitem_mode: '2',
                    Fitem_remark: '45607|45608|45609|45610',
                    Fitem_tag: '冷色 LOMO 快乐 女生'
                }]
            }
        }
    };
    
    QZONE.shop.shopLib || QZONE.create('QZONE.shop.shopLib', QZONE.create._shopLib);
    
    // 0小窝，1全屏，3宽屏
    var savedItemList = '';
    var onbut_flag = false;
    QZONE.shop.suit.add = function(mode){
        if (onbut_flag) {
            return;
        }
        onbut_flag = true;
        
        try {
            savedItemList = QZONE.shop.shopLib.getSavedItemList();
        } 
        catch (e) {
            savedItemList = ''
        }
        var item = QZONE.shop.suit.data[mode].item;
        if (item.Ftype_id == '31') { //套装
            var suitItems = item.suitItems;
            var exist = checkSuitList(item.Fitem_id);
            if (exist) 
                addSavedAll();
            for (var i = 0, l = suitItems.length; i < l; i++) {
                if (exist) {
                    removeItem(suitItems[i]);
                }
                else {
                    QZONE.shop.add(getShopItem(suitItems[i]));
                }
            }
            
        }
        else { //其他
            if (QZONE.shop.searchItem(parseInt(item.Ftype_id), parseInt(item.Fitem_id))) {
                addSavedAll();
                removeItem(item);
            }
            else {
                QZONE.shop.add(getShopItem(item));
            }
        }
        onbut_flag = false;
        return false;
    }
    
    //删除不为一物品
    function removeItem(item){
        if (savedItemList.indexOf(item.Ftype_id + '_' + item.Fitem_id) < 0) {
            switch (item.Ftype_id) {
                case '1': //背景皮肤 
                case '4': //鼠标方案
                case '5': //漂浮物
                case '6': //旧版播放器 
                case '7': //个性花藤 
                case '12': //公告栏
                case '13': //自定义导航栏 
                case '14': //欢迎Flash
                case '18': //新版播放器
                case '19': //标题栏 
                case '20': //黄钻宝贝
                case '22': //魔法秀
                case '49': //QCC皮肤
                    if (QZONE.shop.shopLib.searchItem(item.Ftype_id, item.Fitem_id)) {
                        QZONE.shop.remove(getShopItem(item));
                    }
                    break;
                default:
                    QZONE.shop.remove(getShopItem(item));
            }
        }
    }
    
    //添加最后一次保存装扮
    function addSavedAll(){
        var sitems = savedItemList.split('|');
        for (var i = 0; i < sitems.length; i++) {
            var sitem = sitems[i].split('_');
            for (var j = 0; j < sitem.length; j++) {
                sitem[j] = parseInt(sitem[j]);
            }
            QZONE.shop.add({
                'type': sitem[0],
                'itemno': sitem[1],
                'posx': sitem[2],
                'posy': sitem[3],
                'posz': sitem[4],
                'width': sitem[5],
                'height': sitem[6],
                'flag': sitem[7]
            });
        }
    }
    
    //保存套装方案，兼容老的模式
    if (!top.g_scenario_suitlist) 
        top.g_scenario_suitlist = {
            list: []
        }
    if (!top.g_mall_last_suit_id_one) 
        top.g_mall_last_suit_id_one = 0;
    function checkSuitList(itemId){
        var exist = -1;
        var list = top.g_scenario_suitlist.list;
        for (var i = 0, l = list.length; i < l; i++) {
            if (list[i] == itemId) {
                exist = i;
                break;
            }
        }
        
        if (exist > -1 && top.g_mall_last_suit_id_one == itemId) {
            list = top.g_scenario_suitlist.list = delArray(list, exist);
            top.g_mall_last_suit_id_one = itemId;
            return true;
        }
        else 
            if (exist == -1) {
                list.push(itemId);
            }
        top.g_mall_last_suit_id_one = itemId;
        return false;
    }
    
    //计算QZONE.shop.suit.add所需要的参数对象
    function getShopItem(obj){
        obj.posx = obj.posy = obj.width = obj.height = obj.zindex = 0;
        switch (obj.Ftype_id) {
            case '1'://skin
                var desc = obj.Fdesc;
                var pos = desc.indexOf("@");
                if (pos != -1) {
                    var contype = desc.substr(0, pos);
                    if (contype == 1) {
                        obj.posx = 175;
                    }
                    desc = desc.substring(pos + 1);
                }
                if (0 == obj.Fitem_mode) {
                    obj.zindex = 1 << 3;
                    if ('jpg' == desc) {
                        obj.zindex += 1;
                    }
                }
                else 
                    if (1 == obj.Fitem_mode) {
                        var m = desc.split("|");
                        if (2 == m.length) {
                            var m1 = m[0].split("_");
                            if (3 == m1.length) {
                                obj.posy = m1[0];
                                obj.zindex += (m1[1] << 5);
                                if ('jpg' == m1[2]) {
                                    obj.zindex += 1 << 1;
                                }
                            }
                            if ('jpg' == m[1]) {
                                obj.zindex += 1 << 2;
                            }
                            obj.zindex += 1 << 4;
                        }
                    }
                    else 
                        if (2 == obj.Fitem_mode) {
                            var m = desc.split("|");
                            if (3 == m.length) {
                                if ('jpg' == m[0]) {
                                    obj.zindex += 1;
                                }
                                var m1 = m[1].split("_");
                                if (3 == m1.length) {
                                    obj.posy = m1[0];
                                    obj.zindex += (m1[1] << 5);
                                    if ('jpg' == m1[2]) {
                                        obj.zindex += 1 << 1;
                                    }
                                }
                                if ('jpg' == m[2]) {
                                    obj.zindex += 1 << 2;
                                }
                                obj.zindex += 1 << 3;
                                obj.zindex += 1 << 4;
                            }
                        }
                        else 
                            if (5 == obj.Fitem_mode) {
                                var m = desc.split("|");
                                if (3 == m.length) {
                                    if ('jpg' == m[0]) {
                                        obj.zindex += 1;
                                    }
                                    var m1 = m[1].split("_");
                                    if (3 == m1.length) {
                                        obj.posy = m1[0];
                                        obj.zindex += (m1[1] << 5);
                                        if ('jpg' == m1[2]) {
                                            obj.zindex += 1 << 1;
                                        }
                                    }
                                    if ('jpg' == m[2]) {
                                        obj.zindex += 1 << 2;
                                    }
                                    obj.zindex += 1 << 3;
                                    obj.zindex += 1 << 4;
                                }
                            }
                break;
            case '5'://float
                var m = obj.Fdesc.split("|");
                if (2 == m.length) {
                    obj.posy = m[0];
                    obj.width = m[1];
                }
                break;
            case '7'://flower
                obj.level = obj.Fvip_price;
                break;
            case '11'://big	
                obj.zindex = obj.Fdesc;
                break;
            case '13'://自定义菜单
                obj.zindex = obj.Fdesc;
                break;
            case '19'://标题栏
                var desc = obj.Fdesc + "";
                if (desc.indexOf("gif") != -1) {
                    obj.zindex = 0;
                }
                if (desc.indexOf("jpg") != -1) {
                    obj.zindex = 1;
                }
                if (desc.indexOf("png") != -1) {
                    obj.zindex = 2;
                }
                if (parseInt(desc) > 100) {
                    obj.zindex += 4;
                    obj.posy = parseInt(desc);
                }
                var pw = 0;
                if ((pw = desc.indexOf('|')) != -1) {
                    obj.width = parseInt(desc.substr(pw + 1));
                }
                break;
        }
        if (typeof(obj.Ftype_id) == 'string') {
            obj.Ftype_id_x = parseInt(obj.Ftype_id);
        }
        else {
            obj.Ftype_id_x = obj.Ftype_id;
        }
        if (typeof(obj.Fitem_id) == 'string') {
            obj.Fitem_id_x = parseInt(obj.Fitem_id);
        }
        else {
            obj.Fitem_id_x = obj.Fitem_id;
        }
        if (typeof(obj.posx) == 'string') {
            obj.posx_x = parseInt(obj.posx);
        }
        else {
            obj.posx_x = obj.posx;
        }
        if (typeof(obj.posy) == 'string') {
            obj.posy_x = parseInt(obj.posy);
        }
        else {
            obj.posy_x = obj.posy;
        }
        if (typeof(obj.width) == 'string') {
            obj.width_x = parseInt(obj.width);
        }
        else {
            obj.width_x = obj.width;
        }
        if (typeof(obj.height) == 'string') {
            obj.height_x = parseInt(obj.height);
        }
        else {
            obj.height_x = obj.height;
        }
        if (typeof(obj.zindex) == 'string') {
            obj.zindex_x = parseInt(obj.zindex);
        }
        else {
            obj.zindex_x = obj.zindex;
        }
        return {
            'type': obj.Ftype_id_x,
            'itemno': obj.Fitem_id_x,
            'posx': obj.posx_x,
            'posy': obj.posy_x,
            'posz': 0,
            'width': obj.width_x,
            'height': obj.height_x,
            'flag': obj.zindex_x
        };
    }
    
    //删除数据, n表示第几项, 从0开始算起。
    function delArray(array, n){
        if (!array || array.length < n + 1 || n < 0) {
            return array;
        }
        else {
            var temp = [];
            for (var i = 0; i < array.length; i++) {
                if (i != 0) {
                    temp.push(array[i]);
                }
            }
            return temp;
        }
    }
})();
